#!/bin/bash
set -e

# Navigate to project directory
cd "{{ project_dir }}"

# Load environment variables (if any)
if [ -f .env ]; then
    source .env
fi

# uv may not be in launchd PATH
UV="{{ uv_path }}"

# Run pipeline
$UV run ai-research-assistant run

# Export OPML and commit to GitHub (weekly backup - Mondays)
DAY_OF_WEEK=$(date +%u)
if [ "$DAY_OF_WEEK" -eq 1 ]; then
    $UV run ai-research-assistant feeds export
    git add exports/feeds.opml
    git diff --cached --quiet || git commit -m "Weekly OPML backup $(date +%Y-%m-%d)"
    git push
fi
